<?xml version="1.0"?>

<!--
Copyright 2004 The Apache Software Foundation
Licensed  under the  Apache License,  Version 2.0  (the "License");
you may not use  this file  except in  compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed  under the  License is distributed on an "AS IS" BASIS,
WITHOUT  WARRANTIES OR CONDITIONS  OF ANY KIND, either  express  or
implied.

See the License for the specific language governing permissions and
limitations under the License.
-->
<document>
    <properties>
        <author email="leif.AT.tanukisoftware.DOT.com">Leif Mortenson</author>
        <title>Excalibur Instrument - XML Client - Instrument Sample</title>
    </properties>
    <body>
        <section name="XML Client - Instrument Sample">
            <p>
                The Sample URL is used to obtain information about a particular
                Sample.  To obtain the actual data points of the sample, the
                <a href="xml-client-snapshot.html">Sample Snapshot</a> URL must
                be used.
            </p>
        </section>
        <section name="Request">
            <p>
                Request parameters are set as HTTP GET parameters when sending the
                request to the server.
            </p>
            <p>
                For example, to request the <b>instrument-manager.memory.maximum_1000_600</b>
                Instrument Sample, the following URL can be used.  Note that this assumes
                that such a sample lease has been granted for the specified sample.
            </p>
            <source><a href="http://localhost:15080/sample.xml?name=instrument-manager.memory.maximum_1000_600">http://localhost:15080/sample.xml?name=instrument-manager.memory.maximum_1000_600</a></source>
            <subsection name="Parameters">
                <table>
                    <tr>
                        <th>Name</th>
                        <th>Data Type</th>
                        <th>Description</th>
                        <th>Notes</th>
                    </tr>
                    <tr>
                        <td><b>name</b></td>
                        <td>boolean</td>
                        <td>
                            The fully qualified name of the Instrument Sample being requested.
                            The name is generated by the Instrument Manager when an Instrument
                            Sample is created.   It is built up using three tokens; the type of
                            the sample, the interval and the size (number of data points).
                        </td>
                        <td>Required.</td>
                    </tr>
                    <tr>
                        <td><b>packed</b></td>
                        <td>boolean</td>
                        <td>
                            Normally XML is returned in a human-readable pretty format
                            with indenting and line feeds.   While this makes it easy to
                            work with, it also adds several percent to the size of the
                            XML returned to the client.  By setting the packed parameter
                            to "true", all white space is removed from the generated XML. 
                        </td>
                        <td>Optional.  Defaults to "false".</td>
                    </tr>
                </table>
            </subsection>
        </section>
        <section name="Response XML">
            <p>
                The XML received in the response will be UTF-8 encoded.  The root node
                will be named <b>sample</b> and have the following attributes.
            </p>
            <subsection name="Attributes">
                <table>
                    <tr>
                        <th>Name</th>
                        <th>Data Type</th>
                        <th>Description</th>
                    </tr>
                    <tr>
                        <td><b>name</b></td>
                        <td>String</td>
                        <td>
                            Fully qualified name of the Instrument.  This
                            name is used to reference the Instrument in
                            other requests.
                            The name is generated by the Instrument Manager when an Instrument
                            Sample is created.   It is built up using three tokens; the type of
                            the sample, the interval and the size (number of data points).
                        </td>
                    </tr>
                    <tr>
                        <td><b>description</b></td>
                        <td>String</td>
                        <td>
                            A human readable descripton of the Instrument.  If the Instrument
                            Sample was specified in the <a href="configuration.html">Instrument configuration file</a>
                            then the description may have been specified there.  Otherwise, the
                            description will have been specified as part of the lease request
                            for the sample.
                        </td>
                    </tr>
                    <tr>
                        <td><b>type</b></td>
                        <td>int</td>
                        <td>
                            Specifies the type of the Instrument Sample.
                            <ul>
                                <li><b>101</b> - Counter Sample - Available for Counter Instruments</li>
                                <li><b>102</b> - Minumum Value Sample - Available for Value Instruments</li>
                                <li><b>103</b> - Maximum Value Sample - Available for Value Instruments</li>
                                <li><b>104</b> - Mean Value Sample - Available for Value Instruments</li>
                            </ul>
                        </td>
                    </tr>
                    <tr>
                        <td><b>interval</b></td>
                        <td>long</td>
                        <td>
                            The interval of time, in milliseconds, covered by each data point in
                            the Instrument Sample.
                        </td>
                    </tr>
                    <tr>
                        <td><b>size</b></td>
                        <td>int</td>
                        <td>
                            The number of data points maintained by the Instrument Sample.  If this
                            value is 600, and the interval is 1000, then the full Instrument Sample
                            represents a period of 10 minutes.
                        </td>
                    </tr>
                    <tr>
                        <td><b>value</b></td>
                        <td>int</td>
                        <td>
                            The current value of the most recent data point in the Instrument
                            Sample.
                        </td>
                    </tr>
                    <tr>
                        <td><b>time</b></td>
                        <td>long</td>
                        <td>
                            The time of the beginning of the interval represented by the most
                            recent data point.  If the interval is one 1000, or 1 second, then
                            this will be the current time rounded down to the second.   If it
                            is a larger value like 60000, then it will the current time rounded
                            down to the current minute.
                        </td>
                    </tr>
                    <tr>
                        <td><b>expiration-time</b></td>
                        <td>long</td>
                        <td>
                            The time at which the lease on the Instrument Sample will expire.
                            The lease can be renewed at any time to extend this time.  An
                            expiration time of 0 specifies that the Instrument Sample is
                            permanent.  It is not possible to create a permanent Sample from
                            a client.  They must be configured in the 
                            <a href="configuration.html">Instrument configuration file</a>.
                        </td>
                    </tr>
                    <tr>
                        <td><b>state-version</b></td>
                        <td>int</td>
                        <td>
                            Current State-Version of the Instrument Sample.  The
                            state version will be incremented whenever there are any
                            changes to the Instrument.  It can be compared with a last
                            known state version to decide whether or not it is necessary
                            to to request further details.
                            <p/>
                            Changes to the lease expiration time will cause the state to
                            be incremented.  Individual changes to the <b>value</b> or
                            <b>time</b> attributes occur as Instrument values are set and
                            do not affect the state version.
                            <p/>
                            If the application is running long enough, the
                            state version will eventially overflow.  To makes
                            sure your application will handle this case use
                            an equality test when comparing state versions.
                        </td>
                    </tr>
                    <tr>
                        <td><b>configured</b></td>
                        <td>boolean</td>
                        <td>
                            Indicates whether or not the Instrument Sample has been declared
                            in the <a href="configuration.html">Instrument configuration file</a>.
                            All configured Samples will be permanent, meaning that their
                            <b>expiration-time</b> will be 0.
                        </td>
                    </tr>
                </table>
            </subsection>
        </section>
    </body>
</document>